<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Progress Tracker - Demo</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #2563EB;
            --primary-dark: #1D4ED8;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --gray-50: #F8FAFC;
            --gray-100: #F1F5F9;
            --gray-200: #E2E8F0;
            --gray-600: #475569;
            --gray-800: #1E293B;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
            min-height: 90vh;
        }

        /* Header & Navigation */
        .app-header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .app-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--gray-600);
            font-size: 14px;
        }

        .nav-tabs {
            display: flex;
            background: var(--gray-100);
            border-radius: 12px;
            padding: 4px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--gray-600);
            white-space: nowrap;
        }

        .nav-tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .logout-btn {
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--gray-200);
            color: var(--danger);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            display: grid;
            gap: 20px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gray-200);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Forms */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-800);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Charts */
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }

        /* Progress Section */
        .progress-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .progress-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .app-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-tabs {
                width: 100%;
                justify-content: center;
            }

            .header-left {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Insight Cards */
        .insight-card {
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .insight-success {
            background: #ECFDF5;
            border-left: 4px solid var(--success);
        }

        .insight-warning {
            background: #FFFBEB;
            border-left: 4px solid var(--warning);
        }

        .insight-info {
            background: #EFF6FF;
            border-left: 4px solid var(--primary);
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .insight-title {
            font-weight: 600;
            font-size: 16px;
        }

        /* Measurement History */
        .measurement-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .measurement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid var(--gray-200);
        }

        .measurement-date {
            font-weight: 500;
            color: var(--gray-800);
        }

        .measurement-values {
            display: flex;
            gap: 16px;
        }

        .measurement-value {
            text-align: center;
        }

        .value-number {
            font-weight: 700;
            font-size: 16px;
        }

        .value-label {
            font-size: 12px;
            color: var(--gray-600);
        }

        /* Hidden Class */
        .hidden {
            display: none !important;
        }

        /* Login Screen */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .login-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--gray-800);
            font-size: 28px;
        }

        .login-subtitle {
            text-align: center;
            margin-bottom: 30px;
            color: var(--gray-600);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        /* Demo Info */
        .demo-info {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: var(--gray-100);
            border-radius: 10px;
            color: var(--gray-600);
        }
        
        /* Welcome Message */
        .welcome-message {
            text-align: center;
            margin-bottom: 20px;
            color: var(--gray-600);
        }

        /* Workout Schedule */
        .workout-day {
            margin-bottom: 24px;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
        }

        .workout-header {
            background: var(--gray-100);
            padding: 16px 20px;
            font-weight: 600;
            color: var(--gray-800);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workout-body {
            padding: 20px;
        }

        .exercise {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        .exercise:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .exercise-name {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray-800);
        }

        .exercise-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 8px;
        }

        .exercise-detail {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-600);
            font-size: 14px;
        }

        /* Reset Button */
        .reset-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--gray-200);
        }

        /* Camera Preview */
        .camera-preview {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: var(--gray-200);
            border-radius: 12px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            font-size: 18px;
        }

        .photo-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Nutrition Log */
        .nutrition-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .nutrition-summary {
            margin-top: 20px;
            padding: 16px;
            background: var(--gray-100);
            border-radius: 12px;
        }

        .nutrition-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .nutrition-item:last-child {
            border-bottom: none;
        }

        /* Backup Section */
        .backup-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .backup-actions {
                grid-template-columns: 1fr;
            }
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--gray-100);
            border: 2px dashed var(--gray-300);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .file-label:hover {
            background: var(--gray-200);
            border-color: var(--primary);
        }

        .backup-info {
            margin-top: 20px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }

        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .data-stat {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray-600);
            margin-top: 4px;
        }

        /* User List in Login */
        .user-list {
            margin-top: 20px;
            border-top: 1px solid var(--gray-200);
            padding-top: 20px;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--gray-50);
            border-radius: 8px;
            border: 1px solid var(--gray-200);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-item:hover {
            background: var(--gray-100);
            border-color: var(--primary);
        }

        .user-email {
            font-weight: 500;
            color: var(--gray-800);
        }

        .user-data {
            font-size: 12px;
            color: var(--gray-600);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h1 class="login-title"><i class="fas fa-chart-line"></i> Body Progress Tracker</h1>
        <p class="login-subtitle">Login untuk memulai tracking progress tubuh Anda</p>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" id="loginEmail" class="form-input" placeholder="your@email.com" value="demo@example.com">
        </div>
        <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" id="loginPassword" class="form-input" placeholder="Password" value="password">
        </div>
        <button class="btn btn-primary btn-block" onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>

        <!-- Existing Users List -->
        <div class="user-list" id="userList">
            <h3 style="margin-bottom: 15px; text-align: center;">Akun yang Tersedia</h3>
            <!-- Users will be populated by JavaScript -->
        </div>

        <div class="demo-info">
            <strong>Tip:</strong> Gunakan email berbeda untuk membuat akun baru
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" class="app-container hidden">
        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <div class="app-title">
                    <i class="fas fa-chart-line"></i> Body Progress Tracker
                </div>
                <div class="user-info">
                    <i class="fas fa-user"></i>
                    <span id="currentUserEmail">demo@example.com</span>
                </div>
            </div>
            
            <div class="nav-tabs">
                <div class="nav-tab active" onclick="switchTab('dashboard')">
                    <i class="fas fa-home"></i> Dashboard
                </div>
                <div class="nav-tab" onclick="switchTab('progress')">
                    <i class="fas fa-chart-bar"></i> Progress
                </div>
                <div class="nav-tab" onclick="switchTab('workout')">
                    <i class="fas fa-dumbbell"></i> Workout
                </div>
                <div class="nav-tab" onclick="switchTab('measurements')">
                    <i class="fas fa-ruler"></i> Measurements
                </div>
                <div class="nav-tab" onclick="switchTab('nutrition')">
                    <i class="fas fa-utensils"></i> Nutrition
                </div>
                <div class="nav-tab" onclick="switchTab('backup')">
                    <i class="fas fa-database"></i> Backup
                </div>
                <div class="nav-tab" onclick="switchTab('prediction')">
                    <i class="fas fa-crystal-ball"></i> Prediction
                </div>
            </div>

            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            
            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content active">
                <div class="welcome-message">
                    <h2>Selamat Datang, <span id="userName">Demo User</span>!</h2>
                    <p>Pantau progress tubuh Anda menuju bentuk V-Taper ideal</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="currentWeight">75.2 kg</div>
                        <div class="stat-label">Current Weight</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vTaperRatio">1.48</div>
                        <div class="stat-label">V-Taper Ratio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="workoutCount">12</div>
                        <div class="stat-label">Workouts This Month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="progressDays">45</div>
                        <div class="stat-label">Days of Progress</div>
                    </div>
                </div>

                <div class="progress-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Progress Insights</div>
                        </div>
                        <div id="insightsContainer">
                            <!-- Insights will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Quick Actions</div>
                        </div>
                        <div style="display: grid; gap: 12px;">
                            <button class="btn btn-primary" onclick="switchTab('measurements')">
                                <i class="fas fa-plus"></i> Add Measurement
                            </button>
                            <button class="btn btn-success" onclick="switchTab('photo')">
                                <i class="fas fa-camera"></i> Take Progress Photo
                            </button>
                            <button class="btn btn-primary" onclick="switchTab('nutrition')">
                                <i class="fas fa-utensils"></i> Log Nutrition
                            </button>
                            <button class="btn btn-warning" onclick="switchTab('workout')">
                                <i class="fas fa-dumbbell"></i> View Workout Plan
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recent Progress</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progressTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Body Measurements History</div>
                    </div>
                    <div class="measurement-list" id="measurementList">
                        <!-- Measurements will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Workout Tab -->
            <div id="workoutTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">V-Taper Workout Schedule</div>
                    </div>
                    <div id="workoutSchedule">
                        <!-- Workout schedule will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Measurements Tab -->
            <div id="measurementsTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Add New Measurement</div>
                    </div>
                    <form id="measurementForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div class="form-group">
                                <label class="form-label">Weight (kg)</label>
                                <input type="number" step="0.1" class="form-input" id="inputWeight" required value="74.5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input" id="inputDate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Chest (cm)</label>
                                <input type="number" step="0.1" class="form-input" id="inputChest" required value="100.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Waist (cm)</label>
                                <input type="number" step="0.1" class="form-input" id="inputWaist" required value="82.0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Shoulders (cm)</label>
                                <input type="number" step="0.1" class="form-input" id="inputShoulders" required value="116.5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Arms (cm)</label>
                                <input type="number" step="0.1" class="form-input" id="inputArms" required value="35.5">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" style="margin-top: 20px;">
                            <i class="fas fa-save"></i> Save Measurement
                        </button>
                    </form>
                </div>
            </div>

            <!-- Nutrition Tab -->
            <div id="nutritionTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Nutrition Log</div>
                    </div>
                    <form id="nutritionForm">
                        <div class="nutrition-form">
                            <div class="form-group">
                                <label class="form-label">Food Item</label>
                                <input type="text" class="form-input" id="foodItem" required placeholder="e.g., Chicken Breast">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Calories</label>
                                <input type="number" class="form-input" id="foodCalories" required placeholder="e.g., 200">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Protein (g)</label>
                                <input type="number" step="0.1" class="form-input" id="foodProtein" required placeholder="e.g., 30">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Carbs (g)</label>
                                <input type="number" step="0.1" class="form-input" id="foodCarbs" required placeholder="e.g., 5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fat (g)</label>
                                <input type="number" step="0.1" class="form-input" id="foodFat" required placeholder="e.g., 5">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-input" id="nutritionDate" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block" style="margin-top: 20px;">
                            <i class="fas fa-plus"></i> Add Food Entry
                        </button>
                    </form>
                    
                    <div class="nutrition-summary">
                        <h3 style="margin-bottom: 15px;">Today's Nutrition Summary</h3>
                        <div class="nutrition-item">
                            <span>Total Calories:</span>
                            <span id="totalCalories">0</span>
                        </div>
                        <div class="nutrition-item">
                            <span>Protein:</span>
                            <span id="totalProtein">0g</span>
                        </div>
                        <div class="nutrition-item">
                            <span>Carbs:</span>
                            <span id="totalCarbs">0g</span>
                        </div>
                        <div class="nutrition-item">
                            <span>Fat:</span>
                            <span id="totalFat">0g</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Backup Tab -->
            <div id="backupTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Backup & Restore Data</div>
                    </div>
                    
                    <div class="backup-actions">
                        <button class="btn btn-success" onclick="exportToExcel()">
                            <i class="fas fa-file-excel"></i> Export to Excel
                        </button>
                        
                        <label class="file-label" for="excelFile">
                            <i class="fas fa-file-import"></i>
                            <span>Import from Excel</span>
                        </label>
                        <input type="file" id="excelFile" class="file-input" accept=".xlsx, .xls" onchange="importFromExcel(event)">
                    </div>

                    <div class="backup-info">
                        <h3 style="margin-bottom: 10px;">Data Statistics</h3>
                        <div class="data-stats">
                            <div class="data-stat">
                                <div class="stat-number" id="measurementsCount">0</div>
                                <div class="stat-label">Measurements</div>
                            </div>
                            <div class="data-stat">
                                <div class="stat-number" id="nutritionCount">0</div>
                                <div class="stat-label">Nutrition Entries</div>
                            </div>
                            <div class="data-stat">
                                <div class="stat-number" id="photosCount">0</div>
                                <div class="stat-label">Photos</div>
                            </div>
                            <div class="data-stat">
                                <div class="stat-number" id="workoutsCount">0</div>
                                <div class="stat-label">Workout Days</div>
                            </div>
                        </div>
                    </div>

                    <div class="backup-info">
                        <h3 style="margin-bottom: 10px;">How to Backup</h3>
                        <ol style="padding-left: 20px; margin-bottom: 10px;">
                            <li>Klik "Export to Excel" untuk mendownload file backup</li>
                            <li>Simpan file Excel ke Google Drive atau komputer</li>
                            <li>Untuk restore, klik "Import from Excel" dan pilih file backup</li>
                        </ol>
                        <p><strong>Note:</strong> File Excel berisi semua data measurements, nutrition, dan profile Anda.</p>
                    </div>
                </div>
            </div>

            <!-- Photo Tab -->
            <div id="photoTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Take Progress Photo</div>
                    </div>
                    <div class="camera-preview" id="cameraPreview">
                        <i class="fas fa-camera"></i> Camera Preview
                    </div>
                    <div class="photo-actions">
                        <button class="btn btn-primary" onclick="takePhoto()">
                            <i class="fas fa-camera"></i> Take Photo
                        </button>
                        <button class="btn btn-success" onclick="savePhoto()">
                            <i class="fas fa-save"></i> Save Photo
                        </button>
                    </div>
                    <div id="photoGallery" style="margin-top: 20px;">
                        <!-- Saved photos will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Prediction Tab -->
            <div id="predictionTab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Goal Prediction</div>
                    </div>
                    <div id="predictionResult">
                        <!-- Prediction will be populated by JavaScript -->
                    </div>
                    <div class="chart-container">
                        <canvas id="predictionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Reset Data Section -->
            <div class="reset-section">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Reset Data</div>
                    </div>
                    <p style="margin-bottom: 16px;">Hati-hati! Tindakan ini akan menghapus semua data yang telah Anda input dan mengembalikan aplikasi ke keadaan semula.</p>
                    <button class="btn btn-danger" onclick="resetData()">
                        <i class="fas fa-trash"></i> Reset All Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User Management System
        class UserManager {
            static getCurrentUser() {
                return localStorage.getItem('currentUser');
            }

            static setCurrentUser(email) {
                localStorage.setItem('currentUser', email);
            }

            static logout() {
                localStorage.removeItem('currentUser');
            }

            static getAllUsers() {
                const users = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('bodyProgress_') && key.includes('_measurements')) {
                        const email = key.replace('bodyProgress_', '').replace('_measurements', '');
                        if (email && !users.includes(email)) {
                            users.push(email);
                        }
                    }
                }
                return users;
            }

            static getUserData(email, dataType) {
                const key = `bodyProgress_${email}_${dataType}`;
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            }

            static saveUserData(email, dataType, data) {
                const key = `bodyProgress_${email}_${dataType}`;
                localStorage.setItem(key, JSON.stringify(data));
            }

            static getUserStats(email) {
                const measurements = this.getUserData(email, 'measurements') || [];
                const nutrition = this.getUserData(email, 'nutrition') || [];
                const photos = this.getUserData(email, 'photos') || [];
                const workouts = this.getUserData(email, 'workoutLogs') || [];
                
                return {
                    measurements: measurements.length,
                    nutrition: nutrition.length,
                    photos: photos.length,
                    workouts: workouts.length
                };
            }
        }

        // Demo Data Storage
        class BodyProgressTracker {
            constructor(email) {
                this.email = email;
                this.measurements = this.loadData('measurements', this.getDefaultMeasurements());
                this.nutritionEntries = this.loadData('nutrition', this.getDefaultNutrition());
                this.photos = this.loadData('photos', []);
                this.workoutLogs = this.loadData('workoutLogs', []);
                this.user = this.loadData('user', this.getDefaultUser(email));
                this.progressChart = null;
                this.predictionChart = null;
                this.init();
            }

            loadData(dataType, defaultValue) {
                const data = UserManager.getUserData(this.email, dataType);
                return data !== null ? data : defaultValue;
            }

            saveData(dataType, data) {
                UserManager.saveUserData(this.email, dataType, data);
            }

            getDefaultMeasurements() {
                return [
                    {
                        id: 1,
                        date: '2024-01-01',
                        weight: 78.5,
                        chest: 98,
                        waist: 88,
                        shoulders: 112,
                        arms: 34
                    },
                    {
                        id: 2,
                        date: '2024-01-15',
                        weight: 77.2,
                        chest: 98.5,
                        waist: 86.5,
                        shoulders: 113,
                        arms: 34.5
                    },
                    {
                        id: 3,
                        date: '2024-02-01',
                        weight: 76.0,
                        chest: 99,
                        waist: 85,
                        shoulders: 114,
                        arms: 35
                    },
                    {
                        id: 4,
                        date: '2024-02-15',
                        weight: 75.2,
                        chest: 99.5,
                        waist: 83.5,
                        shoulders: 115,
                        arms: 35.2
                    }
                ];
            }

            getDefaultNutrition() {
                return [
                    {
                        id: 1,
                        date: new Date().toISOString().split('T')[0],
                        food: "Oatmeal",
                        calories: 150,
                        protein: 5,
                        carbs: 27,
                        fat: 3
                    },
                    {
                        id: 2,
                        date: new Date().toISOString().split('T')[0],
                        food: "Chicken Breast",
                        calories: 165,
                        protein: 31,
                        carbs: 0,
                        fat: 3.6
                    },
                    {
                        id: 3,
                        date: new Date().toISOString().split('T')[0],
                        food: "Brown Rice",
                        calories: 216,
                        protein: 5,
                        carbs: 45,
                        fat: 1.8
                    }
                ];
            }

            getDefaultUser(email) {
                return {
                    name: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                    email: email,
                    targetWeight: 72,
                    targetWaist: 78,
                    targetShoulders: 120
                };
            }

            init() {
                // Set current date as default
                document.getElementById('inputDate').valueAsDate = new Date();
                document.getElementById('nutritionDate').valueAsDate = new Date();
                
                // Update user info
                document.getElementById('userName').textContent = this.user.name;
                document.getElementById('currentUserEmail').textContent = this.user.email;
                
                // Load initial data
                this.updateDashboard();
                this.renderMeasurements();
                this.renderWorkoutSchedule();
                this.renderProgressChart();
                this.calculatePrediction();
                this.updateNutritionSummary();
                this.renderPhotoGallery();
                this.updateDataStats();
            }

            saveMeasurements() {
                this.saveData('measurements', this.measurements);
                this.updateDataStats();
            }

            saveNutritionEntries() {
                this.saveData('nutrition', this.nutritionEntries);
                this.updateDataStats();
            }

            savePhotos() {
                this.saveData('photos', this.photos);
                this.updateDataStats();
            }

            saveWorkoutLogs() {
                this.saveData('workoutLogs', this.workoutLogs);
                this.updateDataStats();
            }

            saveUser() {
                this.saveData('user', this.user);
            }

            addMeasurement(measurement) {
                measurement.id = Date.now();
                this.measurements.push(measurement);
                this.measurements.sort((a, b) => new Date(a.date) - new Date(b.date));
                this.saveMeasurements();
                
                this.updateDashboard();
                this.renderMeasurements();
                this.renderProgressChart();
                this.calculatePrediction();
                
                alert('Measurement saved successfully!');
                document.getElementById('measurementForm').reset();
                document.getElementById('inputDate').valueAsDate = new Date();
            }

            addNutritionEntry(entry) {
                entry.id = Date.now();
                this.nutritionEntries.push(entry);
                this.saveNutritionEntries();
                this.updateNutritionSummary();
                
                alert('Nutrition entry saved successfully!');
                document.getElementById('nutritionForm').reset();
                document.getElementById('nutritionDate').valueAsDate = new Date();
            }

            addPhoto(photoData) {
                const photo = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    data: photoData
                };
                this.photos.push(photo);
                this.savePhotos();
                this.renderPhotoGallery();
                
                alert('Photo saved successfully!');
            }

            addWorkoutLog(log) {
                log.id = Date.now();
                this.workoutLogs.push(log);
                this.saveWorkoutLogs();
            }

            calculateVTaperRatio(measurement) {
                return (measurement.shoulders / measurement.waist).toFixed(2);
            }

            getLatestMeasurement() {
                return this.measurements[this.measurements.length - 1];
            }

            getProgressInsights() {
                if (this.measurements.length < 2) {
                    return {
                        type: 'info',
                        title: 'Mulai Perjalananmu',
                        message: 'Tambahkan pengukuran tubuh pertama untuk memulai tracking progress.'
                    };
                }

                const latest = this.getLatestMeasurement();
                const previous = this.measurements[this.measurements.length - 2];
                
                const weightChange = latest.weight - previous.weight;
                const waistChange = latest.waist - previous.waist;
                const shoulderChange = latest.shoulders - previous.shoulders;

                if (weightChange < 0 && waistChange < 0 && shoulderChange > 0) {
                    return {
                        type: 'success',
                        title: 'Progress Optimal! 🎉',
                        message: `Berkat konsistensimu, berat turun ${Math.abs(weightChange).toFixed(1)}kg, pinggang menyusut ${Math.abs(waistChange).toFixed(1)}cm, dan bahu melebar ${shoulderChange.toFixed(1)}cm!`
                    };
                } else if (waistChange >= 0) {
                    return {
                        type: 'warning',
                        title: 'Perhatikan Pola Makan',
                        message: `Pinggang meningkat ${waistChange.toFixed(1)}cm. Coba kurangi kalori dan tingkatkan kardio.`
                    };
                } else if (shoulderChange <= 0) {
                    return {
                        type: 'warning',
                        title: 'Tingkatkan Latihan Bahu',
                        message: 'Fokus pada latihan punggung dan bahu untuk membentuk V-Taper.'
                    };
                } else {
                    return {
                        type: 'info',
                        title: 'Progress Stabil',
                        message: 'Pertahankan konsistensi latihan dan nutrisi.'
                    };
                }
            }

            updateDashboard() {
                if (this.measurements.length > 0) {
                    const latest = this.getLatestMeasurement();
                    document.getElementById('currentWeight').textContent = `${latest.weight} kg`;
                    document.getElementById('vTaperRatio').textContent = this.calculateVTaperRatio(latest);
                }

                // Update insights
                const insights = this.getProgressInsights();
                const insightsContainer = document.getElementById('insightsContainer');
                
                const insightClass = {
                    'success': 'insight-success',
                    'warning': 'insight-warning',
                    'info': 'insight-info'
                };

                const insightIcon = {
                    'success': 'fa-check-circle',
                    'warning': 'fa-exclamation-triangle',
                    'info': 'fa-info-circle'
                };

                insightsContainer.innerHTML = `
                    <div class="insight-card ${insightClass[insights.type]}">
                        <div class="insight-header">
                            <i class="fas ${insightIcon[insights.type]}"></i>
                            <div class="insight-title">${insights.title}</div>
                        </div>
                        <div>${insights.message}</div>
                    </div>
                `;
            }

            renderMeasurements() {
                const container = document.getElementById('measurementList');
                container.innerHTML = '';

                if (this.measurements.length === 0) {
                    container.innerHTML = `
                        <div class="insight-card insight-info">
                            <div class="insight-header">
                                <i class="fas fa-info-circle"></i>
                                <div class="insight-title">Belum Ada Data</div>
                            </div>
                            <div>Tambahkan pengukuran tubuh pertama Anda di tab "Measurements".</div>
                        </div>
                    `;
                    return;
                }

                this.measurements.slice().reverse().forEach(measurement => {
                    const item = document.createElement('div');
                    item.className = 'measurement-item';
                    item.innerHTML = `
                        <div class="measurement-date">
                            ${new Date(measurement.date).toLocaleDateString('id-ID')}
                        </div>
                        <div class="measurement-values">
                            <div class="measurement-value">
                                <div class="value-number">${measurement.weight}kg</div>
                                <div class="value-label">Weight</div>
                            </div>
                            <div class="measurement-value">
                                <div class="value-number">${measurement.waist}cm</div>
                                <div class="value-label">Waist</div>
                            </div>
                            <div class="measurement-value">
                                <div class="value-number">${measurement.shoulders}cm</div>
                                <div class="value-label">Shoulders</div>
                            </div>
                            <div class="measurement-value">
                                <div class="value-number">${this.calculateVTaperRatio(measurement)}</div>
                                <div class="value-label">V-Taper</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(item);
                });
            }

            renderWorkoutSchedule() {
                const container = document.getElementById('workoutSchedule');
                
                const workoutSchedule = [
                    {
                        day: "Day 1: Chest & Triceps",
                        exercises: [
                            { name: "Bench Press", sets: "4", reps: "8-12", rest: "60-90s" },
                            { name: "Incline Dumbbell Press", sets: "3", reps: "10-12", rest: "60s" },
                            { name: "Cable Crossover", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Tricep Pushdown", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Overhead Tricep Extension", sets: "3", reps: "10-12", rest: "60s" }
                        ]
                    },
                    {
                        day: "Day 2: Back & Biceps",
                        exercises: [
                            { name: "Pull-ups", sets: "4", reps: "Failure", rest: "60s" },
                            { name: "Bent Over Row", sets: "4", reps: "8-12", rest: "60-90s" },
                            { name: "Lat Pulldown", sets: "3", reps: "10-12", rest: "60s" },
                            { name: "Seated Cable Row", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Barbell Curl", sets: "3", reps: "10-12", rest: "60s" },
                            { name: "Hammer Curl", sets: "3", reps: "12-15", rest: "45s" }
                        ]
                    },
                    {
                        day: "Day 3: Shoulders & Abs",
                        exercises: [
                            { name: "Overhead Press", sets: "4", reps: "8-12", rest: "60-90s" },
                            { name: "Lateral Raise", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Front Raise", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Reverse Fly", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Hanging Leg Raise", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Russian Twist", sets: "3", reps: "15-20", rest: "30s" }
                        ]
                    },
                    {
                        day: "Day 4: Legs",
                        exercises: [
                            { name: "Squat", sets: "4", reps: "8-12", rest: "90s" },
                            { name: "Romanian Deadlift", sets: "3", reps: "10-12", rest: "60s" },
                            { name: "Leg Press", sets: "3", reps: "12-15", rest: "60s" },
                            { name: "Leg Extension", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Leg Curl", sets: "3", reps: "12-15", rest: "45s" },
                            { name: "Calf Raise", sets: "4", reps: "15-20", rest: "30s" }
                        ]
                    },
                    {
                        day: "Day 5: Rest",
                        exercises: [
                            { name: "Active Recovery", sets: "-", reps: "-", rest: "-" },
                            { name: "Light Cardio", sets: "-", reps: "20-30 min", rest: "-" },
                            { name: "Stretching", sets: "-", reps: "10-15 min", rest: "-" }
                        ]
                    }
                ];

                container.innerHTML = '';
                
                workoutSchedule.forEach(day => {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'workout-day';
                    
                    let exercisesHTML = '';
                    day.exercises.forEach(exercise => {
                        exercisesHTML += `
                            <div class="exercise">
                                <div class="exercise-name">${exercise.name}</div>
                                <div class="exercise-details">
                                    <div class="exercise-detail">
                                        <i class="fas fa-layer-group"></i>
                                        <span>Sets: ${exercise.sets}</span>
                                    </div>
                                    <div class="exercise-detail">
                                        <i class="fas fa-redo"></i>
                                        <span>Reps: ${exercise.reps}</span>
                                    </div>
                                    <div class="exercise-detail">
                                        <i class="fas fa-clock"></i>
                                        <span>Rest: ${exercise.rest}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    dayElement.innerHTML = `
                        <div class="workout-header">
                            <span>${day.day}</span>
                        </div>
                        <div class="workout-body">
                            ${exercisesHTML}
                        </div>
                    `;
                    
                    container.appendChild(dayElement);
                });
            }

            renderProgressChart() {
                const ctx = document.getElementById('progressChart').getContext('2d');
                
                if (this.progressChart) {
                    this.progressChart.destroy();
                }
                
                const labels = this.measurements.map(m => 
                    new Date(m.date).toLocaleDateString('id-ID', { month: 'short', day: 'numeric' })
                );
                
                const weightData = this.measurements.map(m => m.weight);
                const waistData = this.measurements.map(m => m.waist);
                const shoulderData = this.measurements.map(m => m.shoulders);
                
                this.progressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Weight (kg)',
                                data: weightData,
                                borderColor: '#2563EB',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                tension: 0.3,
                                yAxisID: 'y'
                            },
                            {
                                label: 'Waist (cm)',
                                data: waistData,
                                borderColor: '#EF4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.3,
                                yAxisID: 'y1'
                            },
                            {
                                label: 'Shoulders (cm)',
                                data: shoulderData,
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.3,
                                yAxisID: 'y1'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                title: {
                                    display: true,
                                    text: 'Weight (kg)'
                                }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                title: {
                                    display: true,
                                    text: 'Circumference (cm)'
                                },
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    }
                });
            }

            updateNutritionSummary() {
                const today = new Date().toISOString().split('T')[0];
                const todayEntries = this.nutritionEntries.filter(entry => entry.date === today);
                
                const totalCalories = todayEntries.reduce((sum, entry) => sum + entry.calories, 0);
                const totalProtein = todayEntries.reduce((sum, entry) => sum + entry.protein, 0);
                const totalCarbs = todayEntries.reduce((sum, entry) => sum + entry.carbs, 0);
                const totalFat = todayEntries.reduce((sum, entry) => sum + entry.fat, 0);
                
                document.getElementById('totalCalories').textContent = totalCalories;
                document.getElementById('totalProtein').textContent = `${totalProtein.toFixed(1)}g`;
                document.getElementById('totalCarbs').textContent = `${totalCarbs.toFixed(1)}g`;
                document.getElementById('totalFat').textContent = `${totalFat.toFixed(1)}g`;
            }

            renderPhotoGallery() {
                const container = document.getElementById('photoGallery');
                
                if (this.photos.length === 0) {
                    container.innerHTML = `
                        <div class="insight-card insight-info">
                            <div class="insight-header">
                                <i class="fas fa-info-circle"></i>
                                <div class="insight-title">Belum Ada Foto</div>
                            </div>
                            <div>Ambil foto progress pertama Anda untuk memulai dokumentasi visual.</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '<h3 style="margin-bottom: 15px;">Saved Photos</h3>';
                
                this.photos.slice().reverse().forEach(photo => {
                    const photoElement = document.createElement('div');
                    photoElement.className = 'photo-item';
                    photoElement.style.marginBottom = '15px';
                    photoElement.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <i class="fas fa-calendar"></i>
                            <span>${new Date(photo.date).toLocaleDateString('id-ID')}</span>
                        </div>
                        <div class="camera-preview">
                            <i class="fas fa-image"></i> Progress Photo
                        </div>
                    `;
                    container.appendChild(photoElement);
                });
            }

            updateDataStats() {
                document.getElementById('measurementsCount').textContent = this.measurements.length;
                document.getElementById('nutritionCount').textContent = this.nutritionEntries.length;
                document.getElementById('photosCount').textContent = this.photos.length;
                document.getElementById('workoutsCount').textContent = this.workoutLogs.length;
            }

            calculatePrediction() {
                if (this.measurements.length < 2) {
                    document.getElementById('predictionResult').innerHTML = `
                        <div class="insight-card insight-info">
                            <div class="insight-header">
                                <i class="fas fa-info-circle"></i>
                                <div class="insight-title">Data Tidak Cukup</div>
                            </div>
                            <div>Tambahkan lebih banyak pengukuran untuk mendapatkan prediksi yang akurat.</div>
                        </div>
                    `;
                    return;
                }

                const latest = this.getLatestMeasurement();
                const weightTrend = (latest.weight - this.measurements[0].weight) / (this.measurements.length - 1);
                const waistTrend = (latest.waist - this.measurements[0].waist) / (this.measurements.length - 1);
                const shoulderTrend = (latest.shoulders - this.measurements[0].shoulders) / (this.measurements.length - 1);

                const weeksToGoalWeight = Math.abs((this.user.targetWeight - latest.weight) / weightTrend) / 7;
                const weeksToGoalWaist = Math.abs((this.user.targetWaist - latest.waist) / waistTrend) / 7;
                const weeksToGoalShoulders = Math.abs((this.user.targetShoulders - latest.shoulders) / shoulderTrend) / 7;

                const avgWeeks = (weeksToGoalWeight + weeksToGoalWaist + weeksToGoalShoulders) / 3;

                let predictionMessage = '';
                if (avgWeeks <= 8) {
                    predictionMessage = `Tinggal ${Math.round(avgWeeks)} minggu lagi! Pertahankan konsistensimu.`;
                } else if (avgWeeks <= 16) {
                    predictionMessage = `Perkiraan ${Math.round(avgWeeks)} minggu menuju goal. Tetap semangat!`;
                } else {
                    predictionMessage = `Perjalanan masih panjang (${Math.round(avgWeeks)} minggu). Fokus pada konsistensi.`;
                }

                document.getElementById('predictionResult').innerHTML = `
                    <div class="insight-card insight-success">
                        <div class="insight-header">
                            <i class="fas fa-crystal-ball"></i>
                            <div class="insight-title">Prediksi Progress</div>
                        </div>
                        <div>${predictionMessage}</div>
                    </div>
                `;

                this.renderPredictionChart(weightTrend, waistTrend, shoulderTrend);
            }

            renderPredictionChart(weightTrend, waistTrend, shoulderTrend) {
                const ctx = document.getElementById('predictionChart').getContext('2d');
                
                if (this.predictionChart) {
                    this.predictionChart.destroy();
                }
                
                const latest = this.getLatestMeasurement();
                const weeks = 12;
                const labels = Array.from({length: weeks}, (_, i) => `Week ${i+1}`);
                
                const weightData = Array.from({length: weeks}, (_, i) => 
                    Math.max(latest.weight + weightTrend * (i+1) * 7, this.user.targetWeight)
                );
                
                const waistData = Array.from({length: weeks}, (_, i) => 
                    Math.max(latest.waist + waistTrend * (i+1) * 7, this.user.targetWaist)
                );
                
                const shoulderData = Array.from({length: weeks}, (_, i) => 
                    Math.min(latest.shoulders + shoulderTrend * (i+1) * 7, this.user.targetShoulders)
                );
                
                this.predictionChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Weight (kg)',
                                data: weightData,
                                borderColor: '#2563EB',
                                backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                tension: 0.3,
                                borderDash: [5, 5]
                            },
                            {
                                label: 'Waist (cm)',
                                data: waistData,
                                borderColor: '#EF4444',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                tension: 0.3,
                                borderDash: [5, 5]
                            },
                            {
                                label: 'Shoulders (cm)',
                                data: shoulderData,
                                borderColor: '#10B981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.3,
                                borderDash: [5, 5]
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }

            resetData() {
                if (confirm('Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan.')) {
                    this.measurements = [];
                    this.nutritionEntries = [];
                    this.photos = [];
                    this.workoutLogs = [];
                    
                    this.saveMeasurements();
                    this.saveNutritionEntries();
                    this.savePhotos();
                    this.saveWorkoutLogs();
                    
                    this.init();
                    
                    alert('Semua data telah direset!');
                }
            }

            // Excel Export Function
            exportToExcel() {
                try {
                    // Create workbook
                    const wb = XLSX.utils.book_new();
                    
                    // Worksheet 1: Measurements
                    const measurementsData = this.measurements.map(m => ({
                        'Date': m.date,
                        'Weight (kg)': m.weight,
                        'Chest (cm)': m.chest,
                        'Waist (cm)': m.waist,
                        'Shoulders (cm)': m.shoulders,
                        'Arms (cm)': m.arms,
                        'V-Taper Ratio': this.calculateVTaperRatio(m)
                    }));
                    
                    const wsMeasurements = XLSX.utils.json_to_sheet(measurementsData);
                    XLSX.utils.book_append_sheet(wb, wsMeasurements, 'Measurements');
                    
                    // Worksheet 2: Nutrition
                    const nutritionData = this.nutritionEntries.map(n => ({
                        'Date': n.date,
                        'Food Item': n.food,
                        'Calories': n.calories,
                        'Protein (g)': n.protein,
                        'Carbs (g)': n.carbs,
                        'Fat (g)': n.fat
                    }));
                    
                    const wsNutrition = XLSX.utils.json_to_sheet(nutritionData);
                    XLSX.utils.book_append_sheet(wb, wsNutrition, 'Nutrition');
                    
                    // Worksheet 3: User Profile
                    const profileData = [{
                        'Name': this.user.name,
                        'Email': this.user.email,
                        'Target Weight (kg)': this.user.targetWeight,
                        'Target Waist (cm)': this.user.targetWaist,
                        'Target Shoulders (cm)': this.user.targetShoulders,
                        'Export Date': new Date().toLocaleDateString('id-ID')
                    }];
                    
                    const wsProfile = XLSX.utils.json_to_sheet(profileData);
                    XLSX.utils.book_append_sheet(wb, wsProfile, 'Profile');
                    
                    // Generate filename with timestamp
                    const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                    const filename = `BodyProgress_${this.user.name}_${timestamp}.xlsx`;
                    
                    // Export to Excel file
                    XLSX.writeFile(wb, filename);
                    
                    alert(`Data berhasil diexport ke file: ${filename}`);
                } catch (error) {
                    console.error('Export error:', error);
                    alert('Terjadi error saat mengexport data. Silakan coba lagi.');
                }
            }

            // Excel Import Function
            importFromExcel(file) {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        let importedCount = 0;
                        
                        // Import Measurements
                        if (workbook.Sheets['Measurements']) {
                            const measurementsData = XLSX.utils.sheet_to_json(workbook.Sheets['Measurements']);
                            if (measurementsData.length > 0 && confirm(`Import ${measurementsData.length} data measurements?`)) {
                                this.measurements = measurementsData.map((m, index) => ({
                                    id: Date.now() + index,
                                    date: m['Date'],
                                    weight: m['Weight (kg)'],
                                    chest: m['Chest (cm)'],
                                    waist: m['Waist (cm)'],
                                    shoulders: m['Shoulders (cm)'],
                                    arms: m['Arms (cm)']
                                }));
                                importedCount += measurementsData.length;
                            }
                        }
                        
                        // Import Nutrition
                        if (workbook.Sheets['Nutrition']) {
                            const nutritionData = XLSX.utils.sheet_to_json(workbook.Sheets['Nutrition']);
                            if (nutritionData.length > 0 && confirm(`Import ${nutritionData.length} data nutrition?`)) {
                                this.nutritionEntries = nutritionData.map((n, index) => ({
                                    id: Date.now() + index + 1000,
                                    date: n['Date'],
                                    food: n['Food Item'],
                                    calories: n['Calories'],
                                    protein: n['Protein (g)'],
                                    carbs: n['Carbs (g)'],
                                    fat: n['Fat (g)']
                                }));
                                importedCount += nutritionData.length;
                            }
                        }
                        
                        // Import Profile
                        if (workbook.Sheets['Profile']) {
                            const profileData = XLSX.utils.sheet_to_json(workbook.Sheets['Profile']);
                            if (profileData.length > 0) {
                                const profile = profileData[0];
                                this.user.name = profile['Name'] || this.user.name;
                                this.user.email = profile['Email'] || this.user.email;
                                this.user.targetWeight = profile['Target Weight (kg)'] || this.user.targetWeight;
                                this.user.targetWaist = profile['Target Waist (cm)'] || this.user.targetWaist;
                                this.user.targetShoulders = profile['Target Shoulders (cm)'] || this.user.targetShoulders;
                                this.saveUser();
                            }
                        }
                        
                        // Save all imported data
                        this.saveMeasurements();
                        this.saveNutritionEntries();
                        
                        // Update UI
                        this.init();
                        
                        alert(`Import berhasil! ${importedCount} data telah diimport.`);
                        
                    } catch (error) {
                        console.error('Import error:', error);
                        alert('Terjadi error saat mengimport data. Pastikan file Excel formatnya benar.');
                    }
                };
                
                reader.readAsArrayBuffer(file);
            }
        }

        // Global App Instance
        let app;

        // Render user list in login screen
        function renderUserList() {
            const userList = document.getElementById('userList');
            const users = UserManager.getAllUsers();
            
            if (users.length === 0) {
                userList.innerHTML = '<p style="text-align: center; color: var(--gray-600);">Belum ada akun yang tersedia</p>';
                return;
            }
            
            let usersHTML = '';
            users.forEach(email => {
                const stats = UserManager.getUserStats(email);
                usersHTML += `
                    <div class="user-item" onclick="quickLogin('${email}')">
                        <div class="user-email">${email}</div>
                        <div class="user-data">
                            ${stats.measurements} measurements • ${stats.nutrition} nutrition
                        </div>
                    </div>
                `;
            });
            
            userList.innerHTML = `
                <h3 style="margin-bottom: 15px; text-align: center;">Akun yang Tersedia</h3>
                ${usersHTML}
            `;
        }

        // Quick login for existing users
        function quickLogin(email) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = 'password';
            login();
        }

        // Login function
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email) {
                alert('Email harus diisi');
                return;
            }
            
            if (!password) {
                alert('Password harus diisi');
                return;
            }
            
            // Set current user
            UserManager.setCurrentUser(email);
            
            // Initialize app for this user
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            app = new BodyProgressTracker(email);
        }

        // Logout function
        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                UserManager.logout();
                document.getElementById('appContainer').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Clear form
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                
                // Update user list
                renderUserList();
                
                app = null;
            }
        }

        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Special handling for photo tab
            if (tabName === 'photo') {
                document.getElementById('cameraPreview').innerHTML = '<i class="fas fa-camera"></i> Camera Preview';
            }
        }

        // Take photo function (simulated)
        function takePhoto() {
            const preview = document.getElementById('cameraPreview');
            preview.innerHTML = '<i class="fas fa-user"></i> Progress Photo Preview<br><small>Demo Mode - No actual camera access</small>';
            preview.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
            preview.style.color = 'white';
        }

        // Save photo function
        function savePhoto() {
            if (app) {
                app.addPhoto('demo-photo-data');
            }
        }

        // Reset data function
        function resetData() {
            if (app) {
                app.resetData();
            }
        }

        // Export to Excel function
        function exportToExcel() {
            if (app) {
                app.exportToExcel();
            }
        }

        // Import from Excel function
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (file && app) {
                app.importFromExcel(file);
            }
            // Reset file input
            event.target.value = '';
        }

        // Form submission handlers
        document.addEventListener('DOMContentLoaded', function() {
            // Render user list on load
            renderUserList();
            
            // Check if user is already logged in
            const currentUser = UserManager.getCurrentUser();
            if (currentUser) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                app = new BodyProgressTracker(currentUser);
            }
            
            // Measurement form
            document.getElementById('measurementForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (app) {
                    const measurement = {
                        date: document.getElementById('inputDate').value,
                        weight: parseFloat(document.getElementById('inputWeight').value),
                        chest: parseFloat(document.getElementById('inputChest').value),
                        waist: parseFloat(document.getElementById('inputWaist').value),
                        shoulders: parseFloat(document.getElementById('inputShoulders').value),
                        arms: parseFloat(document.getElementById('inputArms').value)
                    };
                    
                    app.addMeasurement(measurement);
                }
            });
            
            // Nutrition form
            document.getElementById('nutritionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (app) {
                    const nutritionEntry = {
                        date: document.getElementById('nutritionDate').value,
                        food: document.getElementById('foodItem').value,
                        calories: parseInt(document.getElementById('foodCalories').value),
                        protein: parseFloat(document.getElementById('foodProtein').value),
                        carbs: parseFloat(document.getElementById('foodCarbs').value),
                        fat: parseFloat(document.getElementById('foodFat').value)
                    };
                    
                    app.addNutritionEntry(nutritionEntry);
                }
            });
        });
    </script>
</body>
</html>